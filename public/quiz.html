<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BodyPedia | Quiz</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="../public/assets/imgs/header_logo.png">
</head>

<body class="quiz-page" onload="onloadEsconder()">
  <!-- ======= HEADER ======= -->
  <div class="header">
    <div class="container">
      <div class="imagem">
        <img src="../public/assets/imgs/header_logo.png" id="logo_header" alt="Logo BodyPedia">
        <h1 class="titulo">BodyPedia</h1>
      </div>
      <ul class="navbar">
        <li><a href="index.html">Home üè†</a></li>
        <li><a href="fisiculturistas.html">Fisiculturistas üèãÔ∏è‚Äç‚ôÄÔ∏è</a></li>
        <li><a href="infoTMB.html">TMB üìä</a></li>
        <li><a href="blog.html">Blog üìñ</a></li>
      </ul>
    </div>
  </div>

  <!-- ======= BANNER ======= -->
  <div class="banner">
    <div class="container">
      <p>Treino, mente e rotina ‚Äî uma jornada completa pelo fisiculturismo</p>
    </div>
  </div>

  <!-- ======= PAINEL QUIZ ======= -->
  <div id="pontuacaoEJogo">
    <button id="btnIniciarQuiz" onclick="iniciarQuiz()">INICIAR QUIZ</button>

    <div id="pontuacao">
      <div id="pontuacaoDuranteJogo">
        <span>Quantidade de acertos: <span id="spanCertas"></span></span>
        <span>Quantidade de erros: <span id="spanErradas"></span></span>
      </div>
      <div id="pontuacaoFinalJogo">
        <span id="pontuacaoFinal">Pontua√ß√£o Final: <span id="spanPontuacaoFinal">***</span></span>
        <span id="msgFinal">***</span>
      </div>
    </div>

    <div id="jogo">
      <div id="infoQuestao"><span>Quest√£o atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span
            id="qtdQuestoes"></span> quest√µes.</span></div>
      <div id="perguntaDaQuestaoAtual"><span id="spanQuestaoExibida"></span></div>
      <div id="infoAlternativas"><span><em>Escolha uma op√ß√£o dentre as abaixo:</em></span></div>

      <div id="opcoes">
        <label class="option-container" id="containerOpcaoA">
          <input type="radio" id="primeiraOpcao" name="option" class="radio" value="Certo">
          <span id="labelOpcaoUm" class="option">Certo</span>
        </label>
        <label class="option-container" id="containerOpcaoB">
          <input type="radio" id="segundaOpcao" name="option" class="radio" value="Errado">
          <span id="labelOpcaoDois" class="option">Errado</span>
        </label>
      </div>

      <div id="botoes">
        <button onclick="submeter()" id="btnSubmeter">Submeter resposta</button>
        <button onclick="avancar()" id="btnProx" disabled>Avan√ßar para pr√≥xima quest√£o</button>
      </div>
    </div>
  </div>

  <!-- ======= FOOTER ======= -->
  <div class="footer">
    <div class="container">
      <h4>Sergio Ingegneri ¬© 2025 SpTech 1CCOB</h4>
    </div>
  </div>

  <!-- ========== SCRIPT ========== -->
  <script>
    /* ----- QUEST√ïES ----- */
    const listaDeQuestoes = [
      // Treinamento
      { id: 1, pergunta: "O m√©todo Heavy Duty foca‚Ä¶", correta: "Certo", area: "Treino" },
      { id: 2, pergunta: "Treinar sem descanso‚Ä¶", correta: "Errado", area: "Treino" },
      { id: 3, pergunta: "Overtraining √©‚Ä¶", correta: "Certo", area: "Treino" },

      // Nutri√ß√£o
      { id: 4, pergunta: "A TMB representa‚Ä¶", correta: "Certo", area: "Nutri√ß√£o" },
      { id: 5, pergunta: "1 g de gordura = 4 kcal.", correta: "Errado", area: "Nutri√ß√£o" },
      { id: 6, pergunta: "As prote√≠nas auxiliam‚Ä¶", correta: "Certo", area: "Nutri√ß√£o" },

      // Complementar
      { id: 7, pergunta: "Dieta de hipertrofia costuma‚Ä¶", correta: "Certo", area: "Complementar" },
      { id: 8, pergunta: "Gordura localizada‚Ä¶", correta: "Errado", area: "Complementar" },
      { id: 9, pergunta: "O sono libera horm√¥nios‚Ä¶", correta: "Certo", area: "Complementar" }
    ];



    /* ----- VARI√ÅVEIS ----- */
    let numeroDaQuestaoAtual = 0, pontuacaoFinal = 0, certas = 0, erradas = 0;
    const quantidadeDeQuestoes = listaDeQuestoes.length;
    let respostasArr = [];   // ser√° enviada ao backend

    /* ----- VISIBILIDADE ----- */
    function onloadEsconder() {
      pontuacao.style.display = "none";
      jogo.style.display = "none";
      pontuacaoFinalJogo.style.display = "none";
    }

    /* ----- INICIAR QUIZ ----- */
    function iniciarQuiz() {
      pontuacao.style.display = "block";
      pontuacaoDuranteJogo.style.display = "block";
      pontuacaoFinalJogo.style.display = "none";
      jogo.style.display = "flex";
      btnIniciarQuiz.style.display = "none";

      numeroDaQuestaoAtual = pontuacaoFinal = certas = erradas = 0;
      respostasArr = [];
      qtdQuestoes.textContent = quantidadeDeQuestoes;
      spanCertas.textContent = spanErradas.textContent = 0;
      spanPontuacaoFinal.textContent = msgFinal.textContent = "***";
      msgFinal.className = "";

      preencherHTMLcomQuestaoAtual(0);
      btnSubmeter.disabled = false; btnProx.disabled = true;
    }

    /* ----- RENDERIZA QUEST√ÉO ----- */
    function preencherHTMLcomQuestaoAtual(idx) {
      habilitarAlternativas(true);
      spanNumeroDaQuestaoAtual.textContent = idx + 1;
      spanQuestaoExibida.textContent = listaDeQuestoes[idx].pergunta;
      primeiraOpcao.checked = segundaOpcao.checked = false;
    }

    /* ----- SUBMETER ----- */
    function submeter() {
      const marcado = document.querySelector('input[name="option"]:checked');
      if (!marcado) { alert("Escolha uma op√ß√£o."); return; }
      btnSubmeter.disabled = true; btnProx.disabled = false;
      habilitarAlternativas(false);
      checarResposta(marcado.value);
    }

    /* ----- CHECAR RESPOSTA ----- */
    function checarResposta(respUsuario) {
      const q = listaDeQuestoes[numeroDaQuestaoAtual];
      const gab = q.correta;

      const containerCorreta = (gab === "Certo") ? containerOpcaoA.id : containerOpcaoB.id;
      const containerErrada = (respUsuario === "Certo") ? containerOpcaoA.id : containerOpcaoB.id;

      if (respUsuario === gab) {
        document.getElementById(containerCorreta).classList.add("text-success-with-bg");
        pontuacaoFinal++; certas++; spanCertas.textContent = certas;
      } else {
        document.getElementById(containerErrada).classList.add("text-danger-with-bg");
        document.getElementById(containerCorreta).classList.add("text-success-with-bg");
        erradas++; spanErradas.textContent = erradas;
      }

      /* === guarda a resposta para enviar ao back === */
      respostasArr.push({
        idPergunta: listaDeQuestoes[numeroDaQuestaoAtual].id,  // usa o campo id
        resposta: respUsuario,
        correta: gab,
        acertou: respUsuario === gab ? 1 : 0
      });

      numeroDaQuestaoAtual++;
      if (numeroDaQuestaoAtual >= quantidadeDeQuestoes)
        btnProx.textContent = "Ver Resultado";
    }

    /* ----- AVAN√áAR ----- */
    function avancar() {
      btnProx.disabled = true; btnSubmeter.disabled = false;
      desmarcarRadioButtons(); limparCores();
      if (numeroDaQuestaoAtual < quantidadeDeQuestoes) {
        preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        if (numeroDaQuestaoAtual === quantidadeDeQuestoes - 1)
          btnProx.textContent = "Ver Resultado";
      } else finalizarJogo();
    }

    /* ----- FINALIZAR ----- */
    function finalizarJogo() {
      jogo.style.display = "none";
      pontuacaoDuranteJogo.style.display = "none";
      pontuacaoFinalJogo.style.display = "block";

      const pct = pontuacaoFinal / quantidadeDeQuestoes;
      let msg, cls;
      if (pct <= 0.3) { msg = "Parece que voc√™ n√£o estudou..."; cls = "text-danger-with-bg"; }
      else if (pct <= 0.8) { msg = "Pode melhorar na pr√≥xima, hein!"; cls = "text-warning-with-bg"; }
      else { msg = "Uau, parab√©ns!"; cls = "text-success-with-bg"; }

      msg += "<br> Voc√™ acertou " + Math.round(pct * 100) + "% das quest√µes.";
      msgFinal.innerHTML = msg; msgFinal.className = cls;
      spanPontuacaoFinal.textContent = pontuacaoFinal + " de " + quantidadeDeQuestoes;

      btnProx.disabled = true; btnSubmeter.disabled = true;

      fetch("/respostas/cadastrar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          idUsuario: sessionStorage.ID_USUARIO,
          respostas: respostasArr
        })
      })
        .then(function () {
          /* espera 5 s antes de ir para a dashboard */
          setTimeout(function () {
            window.location.href = "dashboard.html";
          }, 5000);
        })
        .catch(function (e) {
          console.error("Falha ao salvar:", e);
        });
    }

    /* ----- UTILIT√ÅRIAS ----- */
    function habilitarAlternativas(h) {
      primeiraOpcao.disabled = segundaOpcao.disabled = !h;
    }
    function limparCores() {
      containerOpcaoA.classList.remove("text-danger-with-bg", "text-success-with-bg");
      containerOpcaoB.classList.remove("text-danger-with-bg", "text-success-with-bg");
    }
    function desmarcarRadioButtons() {
      var radios = document.querySelectorAll('input[name="option"]');
      radios.forEach(function (r) { r.checked = false; });
    }
  </script>
</body>

</html>